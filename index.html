<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Place favicon.ico in the root directory -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Tangerine">
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.google-analytics.com/analytics.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous">
    </script>
    <script>
        $(function() {

            $(".calculatorButtons").on("mouseover", function() { //Works for any click on a calculator button
                $(this).css("color", "white");
            }).on("mouseout", function() {
                $(this).removeAttr('style');
            }).on("click", function() {
                $(this).css("background-color", "#2c4645");
                // setTimeout(function(){
                //   $(this).removeAttr('style');
                // }, 2000);
                displayString.setValue($(this).text());
            });

            $(document).keypress(function(event) {
                //alert('Handler for .keypress() called. - ' + String.fromCharCode(event.charCode));
                var keyPress = String.fromCharCode(event.charCode);
                displayString.setValue(String.fromCharCode(event.charCode));
            });

            var MathExpression = {
                x: 0,
                operand: "",
                y: 0,

                // save initial values
                init: function() {
                    var origValues = {};
                    for (var prop in this) {
                        if (this.hasOwnProperty(prop) && prop != "origValues") {
                            origValues[prop] = this[prop];
                        }
                    }
                    this.origValues = origValues;
                },
                // restore initial values
                reset: function() {
                    for (var prop in this.origValues) {
                        this[prop] = this.origValues[prop];
                    }
                },

                value: function() {
                    return `${this.x} ${this.operand} ${this.y}`;
                }
            }

            MathExpression.init();
            var displayString = { //Object that allows us to modify what is going to be written on the display
                displayValue: "",

                setValue: function(value) {
                    if (isNaN(Number(value)) === false) {
                        //console.log(value);
                        for (var i = $("#display-screen").children().length; i > 0; i--) {
                            this.displayValue[i + 1] = this.displayValue[i]; //Push the last digit to left
                            this.displayValue[i] = value; //Change first digit to clicked value
                        }
                        this.displayValue += value; //Add the value to the string
                        this.displayValue = this.displayValue.substring(this.displayValue.length - $("#display-screen").children().length, this.displayValue.length); //Start replacing characters when the string is longer than display space

                    }
                    if (value == "." && this.displayValue.indexOf(".") == -1) {
                        for (var i = $("#display-screen").children().length; i > 0; i--) {
                            this.displayValue[i + 1] = this.displayValue[i]; //Push the last digit to left
                            this.displayValue[i] = value; //Change first digit to clicked value
                        }
                        this.displayValue += value; //Add the value to the string
                        this.displayValue = this.displayValue.substring(this.displayValue.length - $("#display-screen").children().length, this.displayValue.length); //Start replacing characters when the string is longer than display space

                    } else if (isNaN(Number(value))) { //If we have a special character, do something else
                        if (value != "." && value != "=") { //Special treatment for operators
                            if (MathExpression.operand == "") { //Sets our expression if it is brand new
                                  MathExpression.x = parseInt(this.displayValue); //Sets our first varaible
                                  MathExpression.operand = value; //Sets our operand
                            } else {//What happens when we click an operator while we already have one
                                MathExpression.operand = value; //Set to the new operator
                            }
                            this.displayValue = "";
                        }
                        else if (value == "=") { //If our special character is '='
                            if (MathExpression.operand != "") { //Make sure math is possible
                                MathExpression.y = this.displayValue; //Change our y to what number is on display
                                doMaths(); //Do maths with our Expression
                                MathExpression.reset();
                            }
                        }
                        else if(value == "Clr"){
                          MathExpression.reset();
                          this.displayValue = "";
                        }

                    }
                    updateDisplay();
                },

                getValue: function() {
                    return this.displayValue;
                }
            };

            function doMaths() {
              try{
                displayString.displayValue = eval(MathExpression.value()).toString();
                throw "An exception!"
              }
              catch (e){
                console.log(e);
              }
                //console.log(eval(MathExpression.value()));
            };

            function updateDisplay() { //Grabs the actual string value to display and changes the divs
                //console.log(displayString);
                var digits = displayString.getValue().split('').reverse().join(''); //Screen writes from right to left
                if (digits != "") //Only update the screen if the string contains numbers
                    var displayScreen = [].reverse.call($("#display-screen").children()).each(function(i) { //Reverse div array to write right to left
                    $(this).html(digits[i]); //Update the screen with all the new values
                });
                else //Clear the screen
                    var displayScreen = [].reverse.call($("#display-screen").children()).each(function(i) { //Reverse div array to write right to left
                    $(this).html("0"); //Update the screen with all the new values
                });
            }
        });
    </script>
    <style>
        #canvasBody {
            text-align: center;
            margin: 0 auto;
            width: 300px;
            height: 100%;
            padding: 10%;
        }

        #calculatorBody {
            width: 300px;
            height: 600px;
            background-color: silver;
        }

        .calculatorButtons {
            background-color: darkslategrey;
            color: black;
            display: inline-block;
            line-height: 40px;
            width: 40px;
            height: 40px;
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -o-user-select: none;
            cursor: pointer;
        }

        .calculatorButtons:hover {
            cursor: pointer;
        }

        .buttonContainer {
            display: inline-block;
            padding-left: 5px;
            padding-right: 5px;
        }

        #text-area {
            color: rgb(6%, 26.5%, 6%);
            font-family: 'Tangerine', serif;
            font-size: 48px;
        }

        .row {
            padding-top: 20px;
            padding-bottom: 10px;
        }

        @font-face {
            font-family: 'digital-clock-font';
            src: url('./fonts/digital-7.ttf');
            src: url('/home/colin/Documents/Web%20Dev/Calculator%20App/calculator-app/fonts/digital-7.ttf');
        }

        .cell {
            display: inline-block;
            background-color: khaki;
            height: 50px;
            padding-right: 0px;
            width: 35px;
            border-left: 2px solid darkslategray;
            border-top: 2px solid darkslategray;
            border-bottom: 2px solid darkslategray;
            border-right: 0px;
            margin: 0;
            line-height: 35px;
            font-size: 70px;
            font-family: 'digital-clock-font';
            color: darkslategrey
        }

        #display-screen {
            padding: 0;
        }

        body {
            background-color: burlywood;
        }
    </style>

</head>

<body>
    <div id="canvasBody">
        <div style="" id="calculatorBody">
            <div class="row" id="header">
                <div class="row" id="text-area">
                    Fancy Text Area
                </div>
                <div class="row" id="display-screen">
                    <div class="cell" id="cell-pos-0">0</div>
                    <div class="cell" id="cell-pos-1">0</div>
                    <div class="cell" id="cell-pos-2">0</div>
                    <div class="cell" id="cell-pos-3">0</div>
                    <div class="cell" id="cell-pos-4">0</div>
                    <div class="cell" id="cell-pos-5">0</div>
                    <!-- <div class="cell" id="cell-pos-6">0</div> Disabled for now because of clean formatter-->
                    <div <div class="cell" id="cell-pos-f" style="border-right:2px solid darkslategray">0</div>
                </div>
            </div>
            <div id="body">
                <div class="row">
                    <div class="buttonContainer"><span id="calculator-button-7" class="calculatorButtons">7</span></div>
                    <div class="buttonContainer"><span id="calculator-button-8" class="calculatorButtons">8</span></div>
                    <div class="buttonContainer"><span id="calculator-button-9" class="calculatorButtons">9</span></div>
                    <div class="buttonContainer"><span id="calculator-button-/" class="calculatorButtons">/</span></div>
                </div>
                <div class="row">
                    <div class="buttonContainer"><span id="calculator-button-4" class="calculatorButtons">4</span></div>
                    <div class="buttonContainer"><span id="calculator-button-5" class="calculatorButtons">5</span></div>
                    <div class="buttonContainer"><span id="calculator-button-6" class="calculatorButtons">6</span></div>
                    <div class="buttonContainer"><span id="calculator-button-*" class="calculatorButtons">*</span></div>
                </div>
                <div class="row">
                    <div class="buttonContainer"><span id="calculator-button-1" class="calculatorButtons">1</span></div>
                    <div class="buttonContainer"><span id="calculator-button-2" class="calculatorButtons">2</span></div>
                    <div class="buttonContainer"><span id="calculator-button-3" class="calculatorButtons">3</span></div>
                    <div class="buttonContainer"><span id="calculator-button--" class="calculatorButtons">-</span></div>
                </div>
                <div class="row">
                    <div class="buttonContainer"><span id="calculator-button-0" class="calculatorButtons">0</span></div>
                    <div class="buttonContainer"><span id="calculator-button-." class="calculatorButtons">.</span></div>
                    <div class="buttonContainer"><span id="calculator-button-=" class="calculatorButtons">=</span></div>
                    <div class="buttonContainer"><span id="calculator-button-+" class="calculatorButtons">+</span></div>
                </div>
                <div class="row">
                    <div class="buttonContainer"><span id="calculator-button-Clr" class="calculatorButtons">Clr</span></div>
                  </div>
                <div class="row"></div>
                <div class="row"></div>
                <div class="row"></div>
            </div>

        </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.12.0.min.js">
    </script>
    <script>
        window.jQuery || document.write('<script src="js/vendor/jquery-1.12.0.min.js"><\/script>')
    </script>
    <script src="app.js"></script>

</body>

</html>
